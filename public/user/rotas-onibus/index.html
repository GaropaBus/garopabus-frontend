<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="manifest" href="../../manifest.json">
    <title>Rotas de Ônibus</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Garopabus">
    <link rel="icon" type="image/png" sizes="32x32" href="../../assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../../assets/images/android-chrome-192x192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon.ico">
    <link rel="stylesheet" href="../../assets/css/user/rotas-onibus.css">
    <link rel="stylesheet" href="../../assets/css/user/navbar.css">
    <link rel="stylesheet" href="../../assets/css/user/header.css">
    <link rel="stylesheet" href="../../assets/css/base.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="main-title">
                <i class="fa fa-bus"></i>
                <h1>Horários de Ônibus</h1>
            </div>
            <div class="search-container">
                <i class="fa fa-search"></i>
                <input type="text" placeholder="Procure por rotas">
            </div>
        </header>

        <div class="listas-rotas">
            <div class="route-list">
                <h2>Partindo de Garopaba</h2>
                <div class="route-itens">
                    <table>
                        <tbody id="tabelaRotasPartindo">
                            <!-- Preenchido pelo back -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="route-list">
                <h2>Sentido para Garopaba</h2>
                <div class="route-itens">
                    <table>
                        <tbody id="tabelaRotasSentido">
                            <!-- Preenchido pelo back -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <nav>
            <button id="garopabus-map">
                <i class="fa-regular fa-map fa-fw"></i>
                <div>
                    Mapa
                </div>
            </button>
            <button id="garopabus-rotas">
                <i class="fa fa-bus"></i>
                <div>
                    Rotas
                </div>
            </button>
            <button id="garopabus-ajuda">
                <i class="fas fa-info-circle"></i>
                <div>
                    Ajuda
                </div>
            </button>
        </nav>
        
        <div id="install-container" style="display:none; background-color:#f0f0f0; padding:15px; text-align:center; position:fixed; bottom:0; width:100%; z-index:1000;">
            <p id="install-message">Instale o Garopabus no seu celular!</p>
            <button id="install-button" style="background-color:#007bff; color:white; border:none; padding:8px 15px; margin-left:10px;">Instalar</button>
        </div>
        
        <script>
            const installContainer = document.getElementById('install-container');
            const installButton = document.getElementById('install-button');
            const installMessage = document.getElementById('install-message');
            let deferredPrompt;
        
            // Detecta dispositivos iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        
            // Detecta dispositivos Android
            const isAndroid = /Android/.test(navigator.userAgent);
        
            // Função para mostrar banner de instalação
            function showInstallBanner() {
                if (isIOS || isAndroid) {
                    installContainer.style.display = 'block';
                }
        
                if (isIOS) {
                    // Instruções específicas para iOS
                    installMessage.innerHTML = 'Para instalar, toque no botão de compartilhamento e selecione "Adicionar à Tela de Início"';
                }
            }
        
            // Evento para Android (beforeinstallprompt)
            window.addEventListener('beforeinstallprompt', (e) => {
                // Previne comportamento padrão
                e.preventDefault();
                
                // Armazena o evento
                deferredPrompt = e;
                
                // Mostra banner de instalação
                showInstallBanner();
            });
        
            // Listener para botão de instalação
            installButton.addEventListener('click', async () => {
                if (isIOS) {
                    // Para iOS, apenas esconde o banner
                    installContainer.style.display = 'none';
                } else if (isAndroid && deferredPrompt) {
                    // Para Android, mostra prompt de instalação
                    try {
                        // Mostra prompt de instalação
                        await deferredPrompt.prompt();
                        
                        // Espera escolha do usuário
                        const { outcome } = await deferredPrompt.userChoice;
                        
                        if (outcome === 'accepted') {
                            console.log('Usuário aceitou a instalação');
                        } else {
                            console.log('Usuário rejeitou a instalação');
                        }
                        
                        // Limpa o prompt
                        deferredPrompt = null;
                        
                        // Esconde o container
                        installContainer.style.display = 'none';
                    } catch (error) {
                        console.error('Erro ao mostrar prompt de instalação:', error);
                    }
                }
            });
        
            // Evento quando app é instalado
            window.addEventListener('appinstalled', (evt) => {
                installContainer.style.display = 'none';
            });
        
            // Chama função ao carregar a página
            window.addEventListener('load', showInstallBanner);
        </script>

        <script type="module" src="../../assets/js/user/rotas-onibus.js"></script>
        <script src="../../assets/js/user/nav.js"></script>
        <script>
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then((registration) => {
                            console.log('Service Worker registrado com sucesso:', registration.scope);
                        })
                        .catch((error) => {
                            console.log('Falha no registro do Service Worker:', error);
                        });
                });
            }
        </script>
</body>

</html>